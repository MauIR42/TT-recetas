<ngx-spinner name="loader_planning" [fullScreen]="true" type="ball-spin-clockwise-fade" size="medium" color = "#0AAFC6">
	<p class="loading">{{loader_message}}</p>
</ngx-spinner>
<app-header></app-header>
<div class="body-component">
	<div class="d-flex ">
		<div id="sidebar-container">
			<div class="text-center">
				<h5>{{current}} </h5>
				<p class="white-text">{{range_string}}</p>
				<button class="btn strong_blue_clor" (click)="change_menu(menu[ current]['next'])">cambiar a {{menu[ current]['next']}}</button>
				<button class="btn strong_blue_clor" (click)="change_view('recommendation');" *ngIf="current == 'Planeación' ">ver recomendaciones</button>
			</div>
			<div class="text-center">
				<button class="btn strong_blue_clor" (click)="change_view('user_recipes')">mostrar todas las recetas</button>
			</div>
			<div class="menu" >
				<ng-container *ngIf="current == 'Preparación'">
					<p class="d-block text-center">preparados de la semana</p>
					<h5 class="text-center">{{cooked}} de {{menu[current]['total']}}</h5>
					<p class="d-block text-center">preparados para hoy</p>
					<h5 class="text-center">{{menu[current]['week_done'][current_day]}} de {{menu[current]['recipe'][current_day].length}}</h5>
				</ng-container>
				<ng-container *ngIf="current == 'Planeación'">
					<p class="d-block text-center">planeados para la semana</p>
					<h5 class="text-center">{{menu[current]['total']}}</h5>

					<div class="text-center my-3">
						<button class="btn btn-outline-strong mx-auto" (click)="save_changes()">Guardar Cambios</button>
					</div>
				</ng-container>
				<div class="row justify-content-center">
					<div class="col-auto">
						<button class="btn btn-cool" (mouseover)="current_left = 'caret-left-square-fill.svg'" (mouseout)="current_left = 'caret-left-square-fill-white.svg'" (click)="change_day(-1)">
						<img [src]="'assets/images/' + current_left" class="img-fluid arrow">
						</button>
					</div>
					<div class="col-auto">
						<h5 >{{days[current_day]}}</h5>
						</div>
					<div class="col-auto">
						<button class="btn btn-cool">
						<img [src]="'assets/images/' + current_right" class="img-fluid arrow" (mouseover)="current_right = 'caret-right-square-fill.svg'" (mouseout)="current_right = 'caret-right-square-fill-white.svg'" (click)="change_day(1)">
						</button>
					</div>
				</div>
				<!-- revisar por user_id_recipe? -->
				<ul class="list-group list-group-flush "> 
					<li class="list-group-item" *ngFor="let recipe of menu[current]['recipe'][current_day]; let i = index" [ngClass]="(selected_index != -1 && recipe_index != -1 && is_recommended == false && current_day == selected_index && menu[current]['recipe'][current_day][recipe_index]['recipe_id'] == recipe['recipe_id'])? 'orange-back' : status_type[recipe['status_id']]" [class.d-none]="recipe['status_id'] == 4 && !recipe['active']"><a href="#" class="mr-3" (click)="get_recipe(current_day,i,$event)"  [class.stretched-link]="current == 'Preparación'">{{recipes_info[recipe['recipe_id']]['name']}}<ng-container *ngIf="recipe['status_id'] != 1 && recipe['status_id'] != 4"> - {{status_type[recipe['status_id']]}}</ng-container></a> <button class="btn" (click)="delete_recipe(current_day,i)" [class.d-none]="current == 'Preparación'"><img [src]="'assets/images/' + delete_img" class="img-fluid arrow"></button></li>
				</ul>
			</div>
		</div>
		<div >
			<button type="button" (click)="hide_bar()" class="btn blue-button"><img [src]="'assets/images/' + side_bar_icon"></button>
		</div>
		<div class="w-100">
			<div id="content">
				<div class="alert alert-danger col-12 text-center alert-dismissible fade show" role="alert" *ngIf="error_server.length > 0" id="error_message">
						{{error_server}}
						<button type="button" class="close" (click)="error_server = ''">
					    <span aria-hidden="true">&times;</span>
					  </button>
				</div>
				<section *ngIf="show['user_recipes']">
					<div class="container-fluid mt-5">
						<div class="row">
							<div class="col-12">
								<h3>{{current}}</h3>
							</div>
							<div class="col-12">
								<p>{{menu[current]['message']}}</p>
							</div>
						</div>
						<ng-container *ngIf="menu[current]['total'] > 0">
							<div class="row justify-content-center" *ngFor="let day of days; let i = index">
								<div class="col-12">
									<h4>{{day}}</h4>
								</div>
								<div class="col-12" *ngIf=" (menu[current]['recipe'][i].length == 0 && current=='Preparación') || (menu[current]['week_done'][i] == 0 && current == 'Planeación')">
									<h5 class="strong_blue_clor text-center py-2">No hay recetas planeadas para este día.</h5>
								</div>
								<ng-container *ngFor="let recipe of menu[current]['recipe'][i]; let j = index">
									<div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-2 " *ngIf="! (recipe['status_id'] == 4 && !recipe['active'])">
										<div class="card h-100" style="width: 18rem;" >
										 <img [src]="root + recipes_info[recipe['recipe_id']]['image_url']" class="card-img-top" alt="..." *ngIf="recipes_info[recipe['recipe_id']]['image_url'] != null">
										  <img [src]="example_image" class="card-img-top" alt="..." *ngIf="recipes_info[recipe['recipe_id']]['image_url'] == null">
										  <div class="card-header text-center">
										    <p >{{recipes_info[recipe['recipe_id']]['name']}}</p> 
										    <br>
										    <ng-container *ngIf="recipe['status_id'] != 2">
										    	<img src="assets/images/percent-blue.svg" class="img-fluid mr-2">
											    <p class="strong_blue_clor mr-5" style="color:red;" *ngIf="recipe.ingredient_percentage <= 39">{{recipe.ingredient_percentage}} ingr.</p>
											    <p class="strong_blue_clor mr-5" style="color:orange;" *ngIf="recipe.ingredient_percentage >= 40 &&recipe.ingredient_percentage <= 59 ">{{recipe.ingredient_percentage}} ingr.</p>
											    <p class="strong_blue_clor mr-5" style="color:brown;" *ngIf="recipe.ingredient_percentage >= 60 &&recipe.ingredient_percentage <= 79 ">{{recipe.ingredient_percentage}} ingr.</p>
											    <p class="strong_blue_clor mr-5" style="color:green;" *ngIf="recipe.ingredient_percentage >= 80 &&recipe.ingredient_percentage <= 100 ">{{recipe.ingredient_percentage}} ingr.</p>
											 </ng-container>
											 <ng-container *ngIf="recipe['status_id'] == 2">
											 	<p class="strong_blue_clor mr-5">Realizada</p>
											 </ng-container>
										    <img src="assets/images/clock-blue.svg" class="img-fluid mr-2">
										    <p class="strong_blue_clor">{{recipes_info[recipe['recipe_id']]['total_time']}} min.</p>
										    <ng-container *ngIf="recipes_info[recipe['recipe_id']]['user_data']['count']">
										    	<br>
										    	<p>Veces realizada:  <strong class="strong_blue_clor">{{recipes_info[recipe['recipe_id']]['user_data']['count']}}</strong></p>
											</ng-container>
										    <ng-container *ngIf="recipes_info[recipe['recipe_id']]['user_data']['count']">
										    	<br>
											    <img src="assets/images/percent-blue.svg" class="img-fluid mr-2">
											    <p>de recomendación:  <strong class="strong_blue_clor">{{recipes_info[recipe['recipe_id']]['user_data']['last_evaluation']}}</strong></p>
											</ng-container>
											<ng-container *ngIf="! recipes_info[recipe['recipe_id']]['user_data']['count']">
												<br>
												<p>No has realizado esta receta.</p>
											</ng-container>
										    <br>
										    <p *ngIf="recipe['status_id'] == 3">Receta desactivada</p>
										  </div>
										  <div class="card-body">
										    <p class="card-text text-justify">{{recipes_info[recipe['recipe_id']]['description']}}</p>
										    <a href="#" class="btn btn-normal-blue stretched-link text-center w-100" (click)="get_recipe(i,j,$event)">Ver Receta</a>
										  </div>
										</div>
									</div>
								</ng-container>
							</div>	
						</ng-container>
						<div class="row text-center" *ngIf="menu[current]['total'] == 0">
							<div class="col-12" >
								<h4 class="my-5">No tienes una planeación para esta semana</h4>
								<h5>¿Eres nuevo en recettario? realiza la planeación para la siguiente semana y comienza tu inventario</h5>
							</div>
						</div>
						<!-- <div class="w-100 my-3"></div> -->
							
					</div>
				</section>
				<section *ngIf="show['recipe']">
					<div class="container-fluid mt-5">
						<ngx-spinner name="loader_recipe" [fullScreen]="true" type="ball-spin-clockwise-fade" size="medium" color = "#0AAFC6">
							<p class="loading">{{loader_message}}</p>
						</ngx-spinner>
						<div class="row justify-content-center">
							<div class="col-12">
								<h3>{{recipes_info[ current_recipe['id'] ]['name'] }}</h3>
							</div>
							<div class="col-12 col-lg-8">
								<img src="assets/images/clock-blue.svg" class="img-fluid mr-2">
								<p style="display:inline;" class="mb-2">Tiempo aproximado: {{recipes_info[ current_recipe['id'] ]['total_time'] }} min.</p>
								<p class="text-justify">Descripción: {{recipes_info[ current_recipe['id'] ]['description'] }}</p>
								<p class="text-justify">Colesterol por porción: {{recipes_info[ current_recipe['id'] ]['cholesterol'] }} mg.</p>
								<p class="text-justify">Carbohidratos por porción: {{recipes_info[ current_recipe['id'] ]['carbohydrates'] }} g.</p>
								<p class="text-justify">Sodio por porción: {{recipes_info[ current_recipe['id'] ]['sodium'] }} mg.</p>
								<p class="text-justify">Porciones: {{recipes_info[ current_recipe['id'] ]['portions'] }}</p>
							</div>
							<div class="col-12 col-lg-4">
								<img [src]="root + recipes_info[current_recipe['id']]['image_url']" class="card-img-top" alt="..." *ngIf="recipes_info[current_recipe['id']]['image_url'] != null">
								<img [src]="example_image" class="card-img-top" alt="..." *ngIf="recipes_info[current_recipe['id']]['image_url'] == null">
							</div>
							<div class="col-12 pr-5">
								<p><strong> Ingredientes:</strong></p>
								<ul class="list-group list-group-flush">
								  <!-- <li class="list-group-item">Ingrediente 1 x ml.</li>
								  <li class="list-group-item">Ingrediente 2 x ml.</li>
								  <li class="list-group-item">Ingrediente 3 x piezas. (opcional)</li>
								  <li class="list-group-item">Ingrediente 4 x gr.</li>
								  <li class="list-group-item">Ingrediente 5 x ml. (2 cucharadas)</li> -->
								  <li class="list-group-item text-inline" *ngFor="let ingredient of current_recipe['ingredients']">
								  	<p>
								  		{{ingredient['ingredient_name']}} 
								  	</p>
									  	<ng-container *ngIf="ingredient['quantity'] > 0">
									  		<p>
									  		{{ingredient['quantity']}} {{ingredient['unit']}} 
									  		</p>
									  	</ng-container> 
									  	<ng-container *ngIf="ingredient['comment'].length > 0">
									  		<p>
									  		 o {{ingredient['comment']}}
									  		</p>
									  	</ng-container>
									  	<ng-container *ngIf="!is_recommended">
										  	<ng-container *ngIf="current_recipe['has'][ ingredient['ingredient_id'] ] < ingredient['quantity']">
										  		<p class="warning">
										  		 (faltan {{ ingredient['quantity'] - current_recipe['has'][ ingredient['ingredient_id'] ]}} {{ingredient['unit']}} )
										  		</p>
										  	</ng-container> 
										  	<ng-container *ngIf="!current_recipe['has'][ ingredient['ingredient_id'] ] && menu[current]['recipe'][selected_index][recipe_index]['status_id'] != 3">
										  		<p class="warning">
										  		 (faltan {{ ingredient['quantity'] }} {{ingredient['unit']}} )
										  		</p>
										  	</ng-container> 
										 </ng-container>
										 <ng-container *ngIf="is_recommended">
										 	<ng-container *ngIf="stock[ ingredient['ingredient_id'] ] < ingredient['quantity']">
										  		<p class="warning">
										  		 (faltan {{ ingredient['quantity'] - stock[ ingredient['ingredient_id'] ]}} {{ingredient['unit']}} )
										  		</p>
										  	</ng-container> 
										  	<ng-container *ngIf="!stock[ ingredient['ingredient_id'] ]">
										  		<p class="warning">
										  		 (faltan {{ ingredient['quantity'] }} {{ingredient['unit']}} )
										  		</p>
										  	</ng-container> 
										 </ng-container>
								  </li>
								</ul>
							</div>
							<div class="col-12 pr-5">
								<p><strong> Pasos:</strong></p>
								<ul class="list-group list-group-flush">
								  <li class="list-group-item" *ngFor="let step of current_recipe['steps']; let i = index">
								  	 <p>{{i + 1}}. {{step['type_name']}} {{step['description']}}</p>
								  </li>
								</ul>
							</div>
							<div class="col-6 mb-3 text-center" *ngIf="current == 'Preparación' && menu[current]['recipe'][selected_index][recipe_index]['status_id'] == 1">
								<button type="button" class="btn btn-normal-blue" (click)="check_complete_recipe()">He realizado la receta</button>
							</div>
							<div class="col-6 text-center" *ngIf="current == 'Preparación' && menu[current]['recipe'][selected_index][recipe_index]['status_id'] == 1">
								<button type="button" class="btn btn-normal-orange" (click)="deactivate_recipe()">Ya no haré esta receta</button>
							</div>
							<div class="col-6 mb-3 text-center" *ngIf="current == 'Planeación'">
								<button type="button" class="btn btn-normal-blue " (click)="add_recipe()">Agregar receta</button>
							</div>
							<div class="col-6 text-center" *ngIf="current == 'Planeación' && !is_recommended">
								<button class="btn btn-normal-orange " (click)="delete_recipe(selected_index,recipe_index)">Eliminar receta</button>
							</div>
							<div class="col-12 text-center" *ngIf="current == 'Preparación' && menu[current]['recipe'][selected_index][recipe_index]['status_id'] == 3">
								<button type="button" class="btn btn-normal-orange" (click)="reactivate_recipe()">Cambié de parecer, haré la receta</button>
							</div>
							<div class="col-12 text-center" *ngIf="current == 'Preparación' && menu[current]['recipe'][selected_index][recipe_index]['status_id'] == 2">
								<h4> Ya has preparado esta receta ¡Hurra!</h4>
								<h5> Revisa tus otras recetas del día de hoy, también puedes adelantar faltantes de la semana.</h5>
							</div>
						</div>
					</div>
				</section>
				<section *ngIf="show['recommendation']">
					<div class="container-fluid mt-5">
						<ngx-spinner name="loader_recommendation" [fullScreen]="true" type="ball-spin-clockwise-fade" size="medium" color = "#0AAFC6">
							<p class="loading">{{loader_message}}</p>
						</ngx-spinner>
						<div class="row">
							<div class="col-12">
								<h3>Recomendaciones</h3>
							</div>
							<div class="col-12">
								<p>Busca tus recetas semanales en esta sección, se han acomodado según tu inventario y las evaluaciones que les has dado a las recetas.</p>
							</div>
						</div>
						<ng-container *ngIf="has_recommendations">
							<div class="row justify-content-center" *ngFor="let name of recomendation_sections; let i = index">
								<div class="col-12">
									<h4>{{name}}</h4>
								</div>
								<div class="col-12" *ngIf="recommendations[i]['recipe'].length == 0">
									<h5 class="strong_blue_clor text-center py-2">No hay recetas por recomendar en esta sección.</h5>
								</div>
								<div class="col-12 col-md-6 col-lg-4 mb-2 " *ngFor="let recipe of recommendations[i]['recipe']; let j = index">
									<div class="card h-100" style="width: 18rem;" >
									  <img [src]="root + recipes_info[recipe['recipe_id']]['image_url']" class="card-img-top" alt="..." *ngIf="recipes_info[recipe['recipe_id']]['image_url'] != null">
									  <img [src]="example_image" class="card-img-top" alt="..." *ngIf="recipes_info[recipe['recipe_id']]['image_url'] == null">
									  <div class="card-header text-center">
									    <p >{{recipes_info[recipe['recipe_id']]['name']}}</p> 
									    <br>
									    <img src="assets/images/percent-blue.svg" class="img-fluid mr-2">
									    <p class="strong_blue_clor mr-5" style="color:red;" *ngIf="recipe.ingredient_percentage <= 39">{{recipe.ingredient_percentage}} ingr.</p>
									    <p class="strong_blue_clor mr-5" style="color:orange;" *ngIf="recipe.ingredient_percentage >= 40 &&recipe.ingredient_percentage <= 59 ">{{recipe.ingredient_percentage}} ingr.</p>
									    <p class="strong_blue_clor mr-5" style="color:brown;" *ngIf="recipe.ingredient_percentage >= 60 &&recipe.ingredient_percentage <= 79 ">{{recipe.ingredient_percentage}} ingr.</p>
									    <p class="strong_blue_clor mr-5" style="color:green;" *ngIf="recipe.ingredient_percentage >= 80 &&recipe.ingredient_percentage <= 100 ">{{recipe.ingredient_percentage}} ingr.</p>
									    <img src="assets/images/clock-blue.svg" class="img-fluid mr-2">
									    <p class="strong_blue_clor">{{recipes_info[recipe['recipe_id']]['total_time']}} min.</p>
									    <ng-container *ngIf="recipes_info[recipe['recipe_id']]['user_data']['count']">
									    	<br>
									    	<p>Veces realizada:  <strong class="strong_blue_clor">{{recipes_info[recipe['recipe_id']]['user_data']['count']}}</strong></p>
										</ng-container>
									    <ng-container *ngIf="recipes_info[recipe['recipe_id']]['user_data']['count']">
									    	<br>
										    <img src="assets/images/percent-blue.svg" class="img-fluid mr-2">
										    <p>de recomendación:  <strong class="strong_blue_clor">{{recipes_info[recipe['recipe_id']]['user_data']['last_evaluation']}}</strong></p>
										</ng-container>
										<ng-container *ngIf="! recipes_info[recipe['recipe_id']]['user_data']['count']">
											<br>
											<p>No has realizado esta receta.</p>
										</ng-container>
									  </div>
									  <div class="card-body">
									    <p class="card-text text-justify">{{recipes_info[recipe['recipe_id']]['description']}}</p>
									    <a href="#" class="btn btn-normal-blue stretched-link text-center w-100" (click)="get_recipe(i,j,$event, true)">Ver Receta</a>
									  </div>
									</div>
								</div>
								<div class="col-12 text-center" *ngIf="recommendations[i]['has_more']">
									<button class="btn btn-sm btn-outline mt-3" (click)="load_more_recommendations(i)"> Cargar más opciones</button>
								</div>
							</div>	
						</ng-container>
							
					</div>
				</section>
			</div>
		</div>
	</div>	
</div>

<app-confirmation-modal [modal_info]="actual_modal" (accepted)="check_action($event)"></app-confirmation-modal>
<app-week-info-modal [to_show]="to_show" (update_completed)="load_inventory()"></app-week-info-modal>
<app-modal-rate-recipe (done)="complete_recipe($event)"></app-modal-rate-recipe>
<!-- id user_recipe, valores -->